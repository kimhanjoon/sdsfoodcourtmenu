<!DOCTYPE html>
<html lang="ko">
<head>
    <title>delacourt at a glance</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<style>
	.container {
		padding-right: 0px;
		padding-left: 0px;
	}
	.media { 
		overflow: visible;
	}
	</style>
	<link rel="stylesheet" href="http://www.jacklmoore.com/colorbox/example1/colorbox.css">
</head>
<body>

{% if redirect %}
<div class="container-fluid">
	<div class="alert alert-warning alert-dismissible" role="alert">
	  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	  <span class="title_kor">접속 주소가 <strong><a href="http://daag.pe.kr">daag.pe.kr</a></strong>로 바뀌었습니다.</span>
	  <span class="title_eng hidden">Page Address changed to <strong><a href="http://daag.pe.kr">daag.pe.kr</strong></a>.</span>
	</div>
	<script type="text/javascript">
	history.replaceState({}, "", "/");
	</script>
</div>
{% endif %}

<div class="container-fluid">
<button type="button" class="btn btn-primary btn-sm pull-right" id="language">
	<span class="kor">English</span><span class="eng hidden">한글</span>
</button>

<div class="page-header">
	<h1>delacourt <small>at a glance</small></h1>
</div>

{% macro display_foods(foods, floor) %}
{% set foods_length = 0 %}
{% for food in foods %}
{% if food.floor === floor %}
{% set foods_length += 1 %}
	{% if food.soldout %}
	<div class="list-group-item disabled">
		<div class="pull-left text-center" style="width: 80px; margin-right: 10px;">
			<span class="soldout text-danger"><span class="kor">판매종료</span><span class="eng hidden">SOLD OUT</span></span>
		</div>
		<del>
			<span class="title_kor">{{food.title_kor}}</span>
			<span class="title_eng hidden">{{food.title_eng}}</span>
		</del>
		<span class="corner badge pull-right">{{food.corner}}</span>
	</div>
	{% else %}
	<div class="list-group-item collapse-boundary food" data-food-id="{{food.id}}">
		<div class="media">
			<div class="media-left">
				<img class="media-object image" src="{{food.img_src}}" style="width:80px;">
				<a class="image hidden" rel="{{food.floor}}_{{food.id}}" href="{{food.img_src}}"></a>
				{% for img_src_more in food.img_src_more %}
				<a class="image hidden" rel="{{food.floor}}_{{food.id}}" href="{{img_src_more}}"></a>
				{% endfor %}
			</div>
		  <div class="media-body collapse-trigger">
		    <h4 class="media-heading">
		    	<span class="title_kor">{{food.title_kor}}</span>
		    	<span class="title_eng hidden">{{food.title_eng}}</span>
		    	<span class="corner badge pull-right">{{food.corner}}</span>
		    </h4>
		    <div class="pull-left">
			    <span class="kcal">{{food.kcal}} kcal</span> 
			    {% if food.very_high_cal %}<span class="label label-danger"><span class="kor">초고칼로리</span><span class="eng hidden">Very High Calorie</span></span>{% endif %}
			    {% if food.high_cal %}<span class="label label-warning"><span class="kor">고칼로리</span><span class="eng hidden">High Calorie</span></span>{% endif %}
			    {% if food.low_cal %}<span class="label label-info"><span class="kor">저칼로리</span><span class="eng hidden">Low Calorie</span></span>{% endif %}
			    {% if food.very_low_cal %}<span class="label label-success"><span class="kor">초저칼로리</span><span class="eng hidden">Very Low Calorie</span></span>{% endif %}
			    <br />
			    <span class="price payments"><del><span class="eng hidden">&#8361;</span> {{food.price}} <span class="kor">원</span></del><span class="eng hidden">&#8361;</span> {{food.payments}} <span class="kor">원</span></span>
		    </div>
		    <div class="pull-right">
		    	<h4>
			    	{{food.recommendation}}
		    	</h4>
	    	</div>
		  </div>
		</div>
		<div class="collapse">
			<div>
				<button type="button" class="btn btn-default btn-xs take-photo"><span class="kor">실제 사진찍기</span><span class="eng hidden">Take photo</span></button>
				{% if food.thumbs %}
				<div class="pull-right">
					<span class="glyphicon glyphicon-thumbs-up"></span> {{food.thumbs_up}}
					&nbsp;&nbsp;
					<span class="glyphicon glyphicon-thumbs-down"></span> {{food.thumbs_down}}
				</div>
				{% endif %}
			</div>
		</div>
	</div>
	{% endif %}
{% endif %}
{% endfor %}
{% if foods_length === 0 %}
	<div class="list-group-item">
		<span class="kor">지금은 영업하지 않습니다.</span><span class="eng hidden">We're closed now</span>
	</div>
{% endif %}
{% endmacro %}

<div class="panel panel-primary">
	<div class="panel-heading"><span class="kor">지하 1층</span><span class="eng hidden">B1</span>
		<a href="http://www.sdsfoodmenu.co.kr:9106/foodcourt/menuplanner/list?zoneId=ZONE01" class="btn btn-default btn-xs pull-right">Link</a>
	</div>

	<div class="list-group">
		{{ display_foods(foods, 'b1') }}
		{% if snapsnackCollapse === true %}
		<div class="collapse-boundary">
			<div class="list-group-item list-group-item-warning collapse-trigger">
					<span class="title_kor">상세 메뉴를 보려면 클릭하세요.</span>
					<span class="title_eng hidden">Click here for detail.</span>
					<span class="corner badge pull-right">Snapsnack</span>
			</div>
			<div class="collapse" >
				{% for food in foods %}
				{% if food.floor === 'b1-snapsnack' %}
					<div class="list-group-item">
						<span class="title_kor">{{food.title_kor}}</span><span class="title_eng hidden">{{food.title_eng}}</span>
						<span class="price payments"><del><span class="eng hidden">&#8361;</span> {{food.price}} <span class="kor">원</span></del><span class="eng hidden">&#8361;</span> {{food.payments}} <span class="kor">원</span></span>
					</div>
				{% endif %}
				{% endfor %}
			</div>
		</div>
		{% endif %}
	</div>
	
</div>

<div class="panel panel-primary">
	<div class="panel-heading"><span class="kor">지하 2층</span><span class="eng hidden">B2</span>
		<a href="http://www.sdsfoodmenu.co.kr:9106/foodcourt/menuplanner/list?zoneId=ZONE02" class="btn btn-default btn-xs pull-right">Link</a>
	</div>

	<div class="list-group">
	{{ display_foods(foods, 'b2') }}
	</div>
</div>

<div class="panel panel-default">
	<div class="panel-heading"><span class="kor">운영시간 안내</span><span class="eng hidden">Hours of Operation</span></div>
	<div class="panel-body">  
		<span style="font-size: 13px; color: #737373"><span class="kor">아침</span><span class="eng hidden">Breakfast</span> 06:30 - 08:15</span><br>	
		<span style="font-size: 13px; color: #737373"><span class="kor">점심</span><span class="eng hidden">Lunch</span> 11:30 - 13:15</span><br> 
		<span style="font-size: 13px; color: #737373"><span class="kor">저녁</span><span class="eng hidden">Dinner</span> 18:00 - 19:00</span><br>
	</div>
</div>

<div class="panel panel-default">
	<div class="panel-heading"><span class="kor">제작자 알림</span><span class="eng hidden">Notice</span></div>
	<ul class='list-group'>
		<li class="list-group-item">
			<span class="kor">이곳에 표시하는 모든 데이터(이미지 포함)의 권한은 <a href="http://www.sdsfoodmenu.co.kr:9106/foodcourt/menuplanner/list">sdsfoodmenu</a>에 있습니다.</span>
			<span class="eng hidden">Rights of all data including images belong to <a href="http://www.sdsfoodmenu.co.kr:9106/foodcourt/menuplanner/list">sdsfoodmenu</a>.</span>
		</li>
		<li class="list-group-item">
			<span class="kor">이 사이트를 더 좋게 만들어주세요.</span><span class="eng hidden">Any contribution is welcome.</span>
			<a href="https://github.com/kimhanjoon/sdsfoodcourtmenu">GitHub</a>
		</li>
	</ul>
</div>

</div>

<div id="uploadPhotoConfirmMessage" class="hidden">
	<span class="kor">보내주신 사진 외에는 다른 정보를 저장하지 않습니다. 
	한번 보낸 사진은 취소가 불가능합니다.
	사진을 보내겠습니까?</span>
	<span class="eng hidden">Other information except the photo will not be saved.
	The uploaded photo would not be withdrawn.
	Would you like to upload a photo?</span>
</div>
<div id="uploadPhotoSuccessMessage" class="hidden">
	<span class="kor">사진 전송이 완료되었습니다. 
	관리자의 판단에 따라 사용되지 않을 수 있습니다. 
	감사합니다.</span>
	<span class="eng hidden">The transfer is completed.
	Photo may not be used at the discretion of the site manager.
	Thank you.</span>
</div>

{% if googleAnalytics === true %}
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62912065-1', 'auto');
  ga('send', 'pageview');
</script>
{% endif %}

<form class="hidden" action="uploadphoto" method="post" enctype="multipart/form-data">
	<input type="text" id="foodId" name="foodId" />
	<input type="file" id="foodPhoto" name="foodPhoto" accept="image/*" />
</form>

<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="http://malsup.github.com/min/jquery.form.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.6.3/jquery.colorbox-min.js"></script>
<script type="text/javascript">
$(function() {
	$("#language").click(function() {
		$(".kor,.eng,.title_kor,.title_eng").toggleClass("hidden");
	});

	// 브라우저가 영어권으로 셋팅되어있으면 영어가 기본셋팅
	{% if englishLanguage === true %}
	$("#language").click();
	{% endif %}

	// 사진박스 구성
	$("a.image").colorbox({width:"100%"});
	
	// 사진 클릭 이벤트 걸기
	$("img.image").click(function() {
		$(this).next().click();
	});

	// 아코디언 이벤트 걸기
	$(".collapse-trigger").click(function() {
		$(this).closest(".collapse-boundary").find(".collapse").collapse("toggle");
	});

	// 사진찍기 버튼은 공통의 form을 사용하도록 별도 file input을 click하게 만든다.
	$(".take-photo").click(function() {
		if( confirm($("#uploadPhotoConfirmMessage span:not(.hidden)").text()) ) {
			$("#foodId").val($(this).closest(".food").data("food-id"));
			$("#foodPhoto").val("");	// 같은 파일을 업로드해도 동작하도록 초기화
			$("#foodPhoto").click();
		}
	});
    
	// 파일을 서버로 전송
	$("#foodPhoto").change(function (event) {
 		$("form").ajaxSubmit({
 			success: function() { 
 		        alert($("#uploadPhotoSuccessMessage span:not(.hidden)").text()); 
 		    }
 		});
	});
	
});
</script>
</body>
</html>
