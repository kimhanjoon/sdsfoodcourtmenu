<link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.1.3/material.css">

<textarea id="schedule_jamsil"></textarea>
<button id="parse_jamsil">변환</button>
<div id="result_jamsil">

<!-- Simple header with scrollable tabs. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
  <header class="mdl-layout__header">
    <div class="mdl-layout__header-row">
      <!-- Title -->
      <span class="mdl-layout-title">Title</span>
    </div>
    <!-- Tabs -->
    <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
      <a href="#scroll-tab-1" class="mdl-layout__tab is-active">Tab 1</a>
      <a href="#scroll-tab-2" class="mdl-layout__tab">Tab 2</a>
      <a href="#scroll-tab-3" class="mdl-layout__tab">Tab 3</a>
      <a href="#scroll-tab-4" class="mdl-layout__tab">Tab 4</a>
      <a href="#scroll-tab-5" class="mdl-layout__tab">Tab 5</a>
      <a href="#scroll-tab-6" class="mdl-layout__tab">Tab 6</a>
    </div>
  </header>
  <div class="mdl-layout__drawer">
    <span class="mdl-layout-title">Title</span>
  </div>
  <main class="mdl-layout__content">
    <section class="mdl-layout__tab-panel is-active" id="scroll-tab-1">
      <div class="page-content"><!-- Your content goes here --></div>
    </section>
    <section class="mdl-layout__tab-panel" id="scroll-tab-2">
      <div class="page-content"><!-- Your content goes here --></div>
    </section>
    <section class="mdl-layout__tab-panel" id="scroll-tab-3">
      <div class="page-content"><!-- Your content goes here --></div>
    </section>
    <section class="mdl-layout__tab-panel" id="scroll-tab-4">
      <div class="page-content"><!-- Your content goes here --></div>
    </section>
    <section class="mdl-layout__tab-panel" id="scroll-tab-5">
      <div class="page-content"><!-- Your content goes here --></div>
    </section>
    <section class="mdl-layout__tab-panel" id="scroll-tab-6">
      <div class="page-content"><!-- Your content goes here --></div>
    </section>
  </main>
</div>

</div>

<textarea id="schedule_sangam"></textarea>
<button class="btn parse">변환</button>
<div class="result parse"></div>

<textarea id="schedule_bundang"></textarea>
<button class="btn parse">변환</button>
<div class="result parse"></div>

<textarea id="schedule_suwon"></textarea>
<button class="btn parse">변환</button>
<div class="result parse"></div>



<script src="//cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.1.3/material.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>

<script id="schedule_menu_template" type="text/x-handlebars-template">
</script>

<script>

var filterOutPretextList = ["삼성SDS타워", "구분", "*테이크아웃은", "*상기메뉴는", "*allergy"];

var currentdata = null;
$("#parse_jamsil").click(function() {
	var parsed_data = Papa.parse($("#schedule_jamsil").val(), {skipEmptyLines: true});
	
	//TOOD 에러체크
	
	var weekdays = _.chain(parsed_data.data)
	.filter(function(e) {
		return e[0] === "구분";
	})
	.map(function(e) {
		return {
			day1: moment(e[2], "M월 D일").toDate(),
			day2: moment(e[3], "M월 D일").toDate(),
			day3: moment(e[4], "M월 D일").toDate(),
			day4: moment(e[5], "M월 D일").toDate(),
			day5: moment(e[6], "M월 D일").toDate(),
			day6: moment(e[7], "M월 D일").toDate()
		}
	})
	.value();
	
	var currentTime = "";
	var currentFloor = "";
	var currentCorner = "";
	var schedule = _.chain(parsed_data.data)
	.filter(function(e) {
		return _.every(filterOutPretextList, function(ee) {
			return !e[0].startsWith(ee);
		});
	})
	.filter(function(e) {
		return e[0] !== "" || e[1] !== "" || e[2] !== "" || e[3] !== "";
	})
	.map(function(e) {
		var e0_whitoutWhitespace = e[0].replace(/\s/g,"");
		if( e0_whitoutWhitespace === "조식") {
			currentTime = "breakfast";
			currentFloor = "b1";
		}
		else if( e0_whitoutWhitespace === "중식") {
			currentTime = "lunch";
			currentFloor = "b1";
		}
		else if( e0_whitoutWhitespace === "B2중식") {
			currentTime = "lunch";
			currentFloor = "b2";
		}
		else if( e0_whitoutWhitespace === "석식") {
			currentTime = "dinner";
			currentFloor = "b1";
		}
		else if( e[0] !== "" ){
			currentCorner = e[0];
		}
		return {
			time: currentTime,
			floor: currentFloor,
			corner: currentCorner,
			day1: e[2],
			day2: e[3],
			day3: e[4],
			day4: e[5],
			day5: e[6],
			day6: e[7]
		};
	})
	.filter(function(e) {
		return e.day1 !== "" || e.day2 !== "" || e.day3 !== "" || e.day4 !== "" || e.day5 !== "" || e.day6 !== "";
	})
	.each(function(e) {
		if( e.day2 === "") {
			e.day2 = e.day1;
		}
		if( e.day3 === "") {
			e.day3 = e.day2;
		}
		if( e.day4 === "") {
			e.day4 = e.day3;
		}
		if( e.day5 === "") {
			e.day5 = e.day4;
		}
	})
	.value();
	console.table(weekdays);
	console.table(schedule);
	currentdata = schedule;
});

</script>
