<!DOCTYPE html>
<html>
<head>
  <title>delacourt at a glance</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/handsontable/0.29.1/handsontable.full.min.css">
</head>
<body>

  <div class="container-fluid">

<button type="button" class="btn btn-primary btn-sm pull-right" id="send">전송</button>
<button type="button" class="btn btn-primary btn-sm pull-right" id="convert">변환</button>
<button type="button" class="btn btn-primary btn-sm pull-right" id="loadExample">예제</button>

<div class="page-header">
	<h2>delacourt <small>at a glance</small></h2>
</div>

<div id="schedule">
</div>
  </div>


<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handsontable/0.29.1/handsontable.full.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
<script>

$(function() {

	var hot = new Handsontable($("#schedule").get(0), {
		data: Handsontable.helper.createEmptySpreadsheetData(100, 10),
		colWidths: 100,
		contextMenu: true
	});

	$("#loadExample").click(function() {

		var exampleData = JSON.parse('[["삼성SDS타워 Food court Menu","","","","","","","","I1","J1",null],["","","","","","","","","I2","J2",null],["구분","","12월 19일","12월 20일","12월 21일","12월 22일","12월 23일","12월 24일","I3","J3",null],["조 식","","","","","","","","I4","J4",null],["Western","아메리칸조식","아메리칸조식","","","","","","I5","J5",null],["Korean 2","백반세트","북어해장국","들깨쇠고기미역국","닭곰탕&소면사리","파해장국","어묵콩나물김치국 ","","I6","J6",null],["Snap snack","라면    6종"," 델라면/치즈델라면/떡델라면/짬뽕델라면/아침에라면(콩나물,김치,북어)/짜장라면","","","","","","I7","J7",null],["","김밥 1종","델김밥","","","","","","I8","J8",null],["Take-out","죽세트","참치채소죽","단호박죽","단팥죽","계란채소죽","밤죽","","I9","J9",null],["","미니샐러드","5종샐러드(소)/헬시박스/3종 선택 과일","","","","","","I10","J10",null],["","착즙주스","플러스DAY","비타민부스트","핑크바디슬림","골드스킨","루비샴페인","","I11","J11",null],["","선식","사과 / 후레쉬","단호박 / 백년초","바나나 / 까페오레","딸기 / 쑥","뽕잎 / 초코","","I12","J12",null],["","유부초밥","유부초밥/콤보세트(유부초밥&김밥/유부초밥&샐러드/김밥&샐러드)","","","","","","I13","J13",null],["","샌드위치","더블햄토마토샌드위치","허니큐어드햄&치즈샌드위치","햄에그샌드위치","단호박패스트리샌드위치","포테이토&햄샌드위치","","I14","J14",null],["","플러스 김밥 1종\\n(데일리변동)","치즈김밥","참치마요김밥","돈가스김밥","야채쌈제육김밥","오징어튀김김밥","","I15","J15",null],["","","","","","","","","I16","J16",null],["중 식","","","","","","","","I17","J17",null],["Korean 1","찌개\\n(데일리변동)","부대찌개&라면사리","해물된장찌개","얼큰동태무국","한끼사골떡만두국","돼지고기고추장찌개","","I18","J18",null],["Korean 2","소반\\n(데일리변동)","오징어돈육두루치기","고등어구이","들깨순대야채볶음","한끼돈육김치덮밥","안동찜닭","콩비지찌개","I19","J19",null],["탕맛기픈","1주 고정","밀양돼지국밥","","","한끼홍합손수제비","밀양돼지국밥","","I20","J20",null],["","","삼태탕","","","","삼태탕","","I21","J21",null],["Western","데일리변동","베이컨마늘볶음밥","알떡스테이크","차슈볶음밥","한끼스팸김치볶음밥","제육퀘사디아","","I22","J22",null],["","1주 고정","치킨커틀렛","","","","치킨커틀렛","","I23","J23",null],["가츠엔","1주 고정","해물카레우동","","","한끼새우튀김우동","해물카레우동","","I24","J24",null],["","","고구마돈가스","","","","고구마돈가스","","I25","J25",null],["Snap snack","라면    5종","델라면/치즈델라면/떡델라면/짬뽕델라면/짜장라면","","","","","","I26","J26",null],["","김밥    4종","델김밥/참치마요김밥/돈까스김밥/야채쌈제육김밥","","","","","","I27","J27",null],["","떡볶이  3종","매콤떡볶이/치즈떡볶이/뚝배기국물떡볶이","","","","","","I28","J28",null],["","콤보세트(반+반)","콤보A(떡볶이1/2+순대1/2) /\\n 콤보B(떡볶이1/2+튀김1/2) / 콤보C(델라면+델김밥1/2)","","","","","","I29","J29",null],["","튀김 /순대","모듬튀김/순대","","","","","","I30","J30",null],["Take-out","죽세트","버섯채소죽","낙지김치죽","단팥죽","게살채소죽","새우채소죽","","I31","J31",null],["","유부초밥/쌈밥/콤보","유부초밥/쌈밥/콤보세트(유부초밥&김밥)","","","","","","I32","J32",null],["","플러스 김밥 1종\\n(데일리변동)","치즈김밥","참치마요김밥","돈가스김밥","야채쌈제육김밥","오징어튀김김밥","","I33","J33",null],["","샌드위치","더블햄토마토샌드위치","허니큐어드햄&치즈샌드위치","햄에그샌드위치","단호박패스트리샌드위치","포테이토&햄샌드위치","","I34","J34",null],["","착즙주스","스윗시트러스","BBQ블로우아웃","베리와인","썬라이즈","오스트레일리아","","I35","J35",null],["","선식","딸기 / 쑥","뽕잎 / 초코","사과 / 클래식","단호박 / 백년초","바나나 / 까페오레","","I36","J36",null],["","3종 선택 과일","과일팩","","","","","","I37","J37",null],["","샐러드팩","5종샐러드팩/단호박견과류꿀단지","","","","","","I38","J38",null],["","한식도시락","닭불고기도시락","돈육춘장볶음도시락","오돈불고기도시락","꽁치강정도시락","버섯소불고기도시락","","I39","J39",null],["","HOT TO GO","고구마돈가스도시락","토마토치즈파니니도시락","닭꼬치도시락","쇠고기파니니도시락","치킨데리야끼도시락","","I40","J40",null],["","헬스기빙도시락","자몽오렌지샐러드","견과류샐러드","크랜베리롤치즈샐러드","베이컨크루통샐러드","참치양파샐러드","","I41","J41",null],["","","","","","","","","I42","J42",null],[" B2 중 식","","","","","","","","I43","J43",null],["Korean 1","찌개\\n(데일리변동)","부대찌개&라면사리","해물된장찌개","얼큰동태무국","한끼사골떡만두국","돼지고기고추장찌개","","I44","J44",null],["Korean 2","소반\\n(데일리변동)","오징어돈육두루치기","고등어구이","들깨순대야채볶음","한끼돈육김치덮밥","안동찜닭","","I45","J45",null],["고슬고슬비빈","1주 고정","도토리묵산채비빔밥","","","한끼돌솥비빔밥","도토리묵산채비빔밥","","I46","J46",null],["","","더덕소고기돌솥비빔밥","","","","더덕소고기돌솥비빔밥","","I47","J47",null],["Chef\'s Count","데일리변동","레인보우야채볼","버섯크림그라탕","레인보우야채볼","시금치프리타타","오븐치킨커틀렛","","I48","J48",null],["","데일리변동","새싹버섯불고기비빔밥","닭갈비덮밥","유자향돈육불고기","녹두닭죽","콩카레덮밥","","I49","J49",null],["싱푸차이나","1주 고정","해물자장덮밥","","","한끼마파두부덮밥","해물자장덮밥","","I50","J50",null],["","","청두탕면","","","","청두탕면","","I51","J51",null],["우리미각면","1주 고정","비빔밀면","","","한끼어묵잔치국수","비빔밀면","","I52","J52",null],["","","소고기칼국수","","","","소고기칼국수","","I53","J53",null],["나폴리폴리","1주 고정","베이컨김치그라탕","","","한끼알리오올리오","베이컨김치그라탕","","I54","J54",null],["","","콤비네이션피자","","","","블루베리피자","","I55","J55",null],["아시안픽스","1주 고정","팔락파니르&새우튀김","","","한끼만두콤보","팔락파니르&새우튀김","","I56","J56",null],["","","매운닭고기쌀국수","","","","매운닭고기쌀국수","","I57","J57",null],["","","","","","","","","I58","J58",null],["석 식","","","","","","","","I59","J59",null],["Snap snack","라면    4종","델라면/치즈델라면/떡델라면/짬뽕델라면","","","","","","I60","J60",null],["","김밥    4종 ","델김밥/참치마요김밥/돈까스김밥/야채쌈제육김밥","","","","","","I61","J61",null],["","떡볶이  3종","매콤떡볶이/치즈떡볶이/뚝배기국물떡볶이","","","","","","I62","J62",null],["","콤보세트(반+반)","콤보A(떡볶이1/2+순대1/2) /\\n 콤보B(떡볶이1/2+튀김1/2) / 콤보C(델라면+델김밥1/2)","","","","","","I63","J63",null],["","튀김 /순대","모듬튀김/순대","","","","","","I64","J64",null],["Korean2","데일리변동","묵은지닭고기찜","전주콩나물해장국","완자김치찌개","해물순두부찌개","콩나물돌솥밥","","I65","J65",null],["Western","데일리변동","떡갈비스테이크","소시지리조또","차슈볶음밥","하와이안함박스테이크","왕새우오므라이스","","I66","J66",null],["탕맛기픈","데일리변동","평창장국밥","콩비지감자탕","삼태탕","맑은낙지설렁탕","쇠고기국수전골","","I67","J67",null],["가츠엔","데일리변동","퐁듀돈가스","해물카레우동","고구마돈가스","오야꼬동","김치나베돈가스","","I68","J68",null],["","","","","","","","","I69","J69",null],["","","","","","","","","I70","J70",null],["*테이크아웃은 조기 품절 될수 있습니다.","","","","take out 메뉴 카페 소량 한정판매","","","","I71","J71",null],["*상기메뉴는 식재수급 상황에 따라 변경될 수 있습니다. ","","","","지하1층 동관 카페","샐러드류(小)","08:15~소진시","","I72","J72",null],["*allergy 관련 문의사항은 02-414-3973번으로 부탁드리겠습니다. ","","","","지하1층 동관 카페","샐러드류(大)","13:15~소진시","","I73","J73",null],["","","","","26층 서관 카페","샐러드류(大)","11:30~소진시","","I74","J74",null],["","","","","","","","","I75","J75",null],["A76","B76","C76","D76","E76","F76","G76","H76","I76","J76",null],["A77","B77","C77","D77","E77","F77","G77","H77","I77","J77",null],["A78","B78","C78","D78","E78","F78","G78","H78","I78","J78",null],["A79","B79","C79","D79","E79","F79","G79","H79","I79","J79",null],["A80","B80","C80","D80","E80","F80","G80","H80","I80","J80",null],["A81","B81","C81","D81","E81","F81","G81","H81","I81","J81",null],["A82","B82","C82","D82","E82","F82","G82","H82","I82","J82",null],["A83","B83","C83","D83","E83","F83","G83","H83","I83","J83",null],["A84","B84","C84","D84","E84","F84","G84","H84","I84","J84",null],["A85","B85","C85","D85","E85","F85","G85","H85","I85","J85",null],["A86","B86","C86","D86","E86","F86","G86","H86","I86","J86",null],["A87","B87","C87","D87","E87","F87","G87","H87","I87","J87",null],["A88","B88","C88","D88","E88","F88","G88","H88","I88","J88",null],["A89","B89","C89","D89","E89","F89","G89","H89","I89","J89",null],["A90","B90","C90","D90","E90","F90","G90","H90","I90","J90",null],["A91","B91","C91","D91","E91","F91","G91","H91","I91","J91",null],["A92","B92","C92","D92","E92","F92","G92","H92","I92","J92",null],["A93","B93","C93","D93","E93","F93","G93","H93","I93","J93",null],["A94","B94","C94","D94","E94","F94","G94","H94","I94","J94",null],["A95","B95","C95","D95","E95","F95","G95","H95","I95","J95",null],["A96","B96","C96","D96","E96","F96","G96","H96","I96","J96",null],["A97","B97","C97","D97","E97","F97","G97","H97","I97","J97",null],["A98","B98","C98","D98","E98","F98","G98","H98","I98","J98",null],["A99","B99","C99","D99","E99","F99","G99","H99","I99","J99",null],["A100","B100","C100","D100","E100","F100","G100","H100","I100","J100",null],[null,null,null,null,null,null,null,null,null,null,null]]');
		_.chain(exampleData)
		.each(function(e, i) {
			if( i >= 75 ) {
				e[0] = "";
				e[1] = "";
				e[2] = "";
				e[3] = "";
				e[4] = "";
				e[5] = "";
				e[6] = "";
				e[7] = "";
		    }
		    e[8] = "";
		    e[9] = "";
		    e[10] = "";
		})
		.value();

		hot.loadData(exampleData);
	});

	$("#convert").click(function() {

		var data = hot.getData();

		_.chain(data)
		.each(function(e) {
			e[10] = e[9];
			e[9] = e[8];
			e[8] = e[7];
			e[7] = e[6];
			e[6] = e[5];
			e[5] = e[4];
			e[4] = e[3];
			e[3] = e[2];
			e[2] = e[0];
			e[1] = "";
			e[0] = "";
		})
		.each(function(e, i, list) {
			if( e[2] === "조 식" ) {
				e[0] = "breakfast";
				e[1] = "b1";
		    }
			else if( e[2] === "중 식" ) {
				e[0] = "lunch";
				e[1] = "b1";
		    }
			else if( e[2] === " B2 중 식" ) {
				e[0] = "lunch";
				e[1] = "b2";
		    }
			else if( e[2] === "석 식" ) {
				e[0] = "dinner";
				e[1] = "b1";
		    }
			else if( i > 0 ) {
				e[0] = list[i-1][0];
				e[1] = list[i-1][1];
		    }

			if( !e[2] ) {
				e[2] = list[i-1][2];
		    }

			if( e[3] ) {
				e[4] = e[4] ? e[4] : e[3];
				e[5] = e[5] ? e[5] : e[4];
				e[6] = e[6] ? e[6] : ( list[i-1][6].startsWith("한끼") ? "" : e[5]);
				e[7] = e[7] ? e[7] : e[6];
		    }

			e.pop();
			e.pop();
		})
		.each(function(e, i, list) {
			if( e[2] === "Snap snack" ) {
				e[1] += "s";
			}
			else if( e[2] === "Take-out" ) {
				e[1] += "t";
			}
		})
		.value();
		hot.render();

		data = _.chain(data)
			.reject(function(e) {
				return _.contains(["삼성SDS타워 Food court Menu", "조 식", "중 식", " B2 중 식", "석 식"], e[2]);
			})
			.reject(function(e) {
				return !e[3];
			})
			.value();
		data[0][0] = "time";
		data[0][1] = "floor";
		data[0][2] = "corner";

		var makeYMD = function(text) {
			return moment(text, "MM월 DD일").format("YYYYMMDD");
		}

		data[0][3] = makeYMD(data[0][3]);
		data[0][4] = makeYMD(data[0][4]);
		data[0][5] = makeYMD(data[0][5]);
		data[0][6] = makeYMD(data[0][6]);
		data[0][7] = makeYMD(data[0][7]);
		data[0][8] = makeYMD(data[0][8]);

		hot.loadData(data);
	});

	$("#send").click(function() {

		var data = hot.getData();

		var header = data[0];

		var makeSchedule = function(index) {
			return _.chain(data)
				.reject(function(e, i) {
					return i === 0;
				})
				.reject(function(e) {
					return !e[index];
				})
				.map(function(e, i, list) {
					return {
				        time: e[0],
				        floor: e[1],
				        corner: e[2],
				        title_kor: e[index]
				    };
				})
				.value();
		};

		var schedule = {};
		schedule[header[3]] = makeSchedule(3);
		schedule[header[4]] = makeSchedule(4);
		schedule[header[5]] = makeSchedule(5);
		schedule[header[6]] = makeSchedule(6);
		schedule[header[7]] = makeSchedule(7);
		schedule[header[8]] = makeSchedule(8);

		console.log(schedule);

		_.each(schedule, function(e, i) {
			$.ajax({
					type: "POST",
					url: '/jamsil/' + i,
					data: JSON.stringify(e),
					contentType: 'application/json; charset=UTF-8'
				});
		});

	});
});
</script>
</body>
</html>
